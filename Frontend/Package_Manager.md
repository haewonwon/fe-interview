# Package Manager

### 1. npm

**정의**

- Node.js의 기본 패키지 매니저로, 전 세계적으로 가장 많이 사용되는 패키지 관리 도구

**개념**

- package.json 기반의 의존성 관리
- 의존성은 node_modules 폴더에 설치됨
- npm install, npm update, npm publish 등의 명령어 사용
- 버전 7 이후부터 workspace 기능을 지원

**장점**

- 기본 제공 도구, 별도 설치 불필요
- 생태계가 가장 큼
- 다양한 문서 및 커뮤니티 자료
- npm audit을 통한 보안 점검 가능

**단점**

- node_modules의 무거움 (디스크 낭비)
- 유령 의존성 발생 가능
- 설치 속도가 상대적으로 느림 (특히 대규모 프로젝트에서)

### 2. Yarn Classic (1.x)

**정의**

- npm의 단점을 보완하기 위해 Facebook이 만든 패키지 매니저. npm 대비 빠른 설치 속도와 보다 안정적인 lockfile 처리를 제공함

**개념**

- yarn.lock 파일을 통해 의존성 버전 고정
- 병렬 설치로 빠른 속도
- node_modules를 사용
- yarn install, yarn add, yarn remove 등 명령어 구성

**장점**

- npm보다 빠른 설치 (병렬 설치)
- lockfile의 안정성 높음
- 유령 의존성 확인 가능 (yarn check)
- 초기 모노레포 도입 가능

**단점**

- node_modules 존재 → 디스크 공간 문제
- 유령 의존성은 완전히 막을 수 없음
- Yarn 2 이후와는 별개의 체계 (업그레이드 시 완전히 새로 학습 필요)

### 3. pnpm

**정의**

- pnpm은 Node.js 환경에서 사용하는 고성능의 패키지 매니저로, npm과 yarn에 비해 더 빠르고 디스크 효율적인 방식으로 패키지를 관리함

**개념**

- Content-addressable store를 사용하여 패키지를 전역 저장소에 한 번만 저장함
- 프로젝트마다 패키지를 복사하는 대신 하드 링크 및 심볼릭 링크로 연결하여 중복 저장을 피함
- 설치 속도 향상 및 디스크 공간 절약이 가능함
- 모노레포를 지원하는 workspace 기능 제공

**장점**

- 빠른 설치 속도
- 스토리지 절약
- 유령 의존성 방지
- workspace를 통한 모노레포 관리에 적합
- 설치 무결성 보장 (lockfile)
- .npmrc 설정과 호환 가능 (npm과 유사한 설정 방식)

**단점**

- 생태계 규모는 npm보다 작음
- 특정 레거시 도구와 호환되지 않을 수 있음
- 링크 구조에 익숙하지 않은 개발자는 디버깅이 다소 어려울 수 있음

### 4. Yarn Berry (2.x 이상)

**정의**

- Yarn Berry는 Yarn의 2.0 이상의 버전을 의미하며, 기존 node_modules 방식에서 탈피해 **Plug'n'Play(PnP)** 와 Zero Install 철학을 도입한 패키지 매니저

**개념**

- node_modules 없이 .pnp.cjs 파일을 통해 의존성 경로를 매핑
- 패키지를 .yarn/cache에 zip 형태로 저장
- 의존성을 코드와 함께 Git에 포함시키는 Zero Install 방식
- 모노레포를 지원하는 workspaces 기능 포함

**장점**

- 빠른 설치 속도
- 의존성 관리 명확성 향상 (의존성 경로가 파일로 명시됨)
- Zero Install: 브랜치 변경 시에도 install 생략 가능
- 유령 의존성 방지
- zip 압축으로 디스크 공간 효율적

**단점**

- 러닝 커브가 존재 (기존 yarn과 사용 방식이 많이 다름)
- .pnp.cjs 기반의 호환성 문제 발생 가능 (특히 일부 레거시 툴)
- 외부 패키지는 여전히 PnP를 완전히 지원하지 않음
- 커스텀 명령어(yarn dlx, yarn plugin)에 익숙해져야 함

---

### 유령 의존성(Phantom Dependency) 문제란?

**정의**

- 직접 package.json에 명시하지 않았지만, 다른 패키지의 의존성을 통해 우연히 사용 가능한 상태가 되는 패키지를 뜻합니다. 예를 들어 A 패키지에서 B를 사용하고 있는데, B가 A에 직접 명시된 적 없이 다른 의존성에 의해 설치되어 있는 경우입니다.

**문제점**

- 명시적이지 않아 추후 유지보수에서 오류 발생 가능
- 의존성 충돌, 예기치 못한 오류 발생
- npm install만으로 재현이 어려운 환경 문제 발생

> **pnpm / Yarn Berry의 해결 방식**
>
> - pnpm: 의존성 트리를 엄격히 분리하여 직접 명시된 패키지만 접근 가능하게 합니다.
> - Yarn Berry: .pnp.cjs에서 패키지 접근 경로를 명시적으로 정의하여 의존성 누락/중복을 방지합니다.

### 유령 의존성(Phantom Dependency) 대응 요약

| 패키지 매니저 | 유령 의존성 방지 여부 | 방식 설명                                       |
| ------------- | --------------------- | ----------------------------------------------- |
| npm           | ❌ 불완전함           | 트리 순서에 따라 우연히 생김                    |
| Yarn 1.x      | ❌ 일부 확인 가능     | yarn check로 점검 가능하지만 완전 방지는 어려움 |
| pnpm          | ✅ 엄격히 방지        | 패키지 간 격리된 구조 유지                      |
| Yarn 2+       | ✅ 완전 차단          | .pnp.cjs로 패키지 경로를 명시적 설정            |
