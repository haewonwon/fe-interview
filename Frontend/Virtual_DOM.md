# Virtual DOM

### 정의

- Virtual DOM은 실제 DOM의 가벼운 복사본(자바스크립트 객체)으로, 변경 사항을 메모리상에서 먼저 계산하고 실제 DOM에는 최소한의 변경만 반영하는 구조이다.

- 이는 React, Vue 등 Component Library/Framework에서 사용하는 핵심 개념이며, 성능 최적화의 중요한 수단이다.

### 왜 Virtual DOM이 등장했을까?

**브라우저의 기본 렌더링 구조**

1. DOM Tree 구성

- HTML 파싱 → DOM 트리 생성

2. Render Tree 생성

- CSS 파싱 → DOM에 스타일 적용

3. Reflow (Layout)

- 각 요소의 위치 및 크기 계산

4. Painting

- 실제 픽셀로 그리기

**비효율의 원인**

- DOM 조작 시마다 이 4단계 전체가 재실행됨
- 이벤트 하나에 여러 DOM 요소가 변경되면 각각의 변경마다 반복됨 → 성능 저하

### Virtual DOM이란?

> 브라우저 렌더링 구조에 추상적인 단계(=Virtual Tree)를 추가하여 성능을 최적화하는 방식

> Virtual DOM의 핵심 아이디어: 브라우저에 반영하기 전, 메모리상에서 먼저 변경 사항을 계산하고 최소한만 반영하자.

1. 상태 변경: 컴포넌트의 state나 props가 변경되면 새로운 Virtual DOM 생성
2. Reconciliation: 이전 Virtual DOM과 새로운 Virtual DOM을 비교 (diff)
3. DOM 업데이트: 차이점만 실제 DOM에 반영 (Patch)

이 과정을 통해 React는 전체 UI를 새로 렌더링하지 않고도 효율적인 UI 업데이트가 가능하다.

### Virtual DOM의 작동 방식

1. 사용자 상호작용(이벤트 등) 발생
2. 변경 사항이 Virtual DOM에 먼저 반영됨
3. Diffing 알고리즘으로 이전 Virtual DOM과 비교
4. 변경된 부분만 실제 DOM에 적용 (Reflow & Paint 최소화)

### React의 diffing 알고리즘 최적화 방법

실제로 DOM 트리를 비교하는 문제는 최악의 경우, **O(n³)**의 복잡도를 가진다.
하지만 React는 두 가지 휴리스틱(heuristic) 가정을 통해 O(n) 수준으로 성능을 개선했다.

1. 서로 다른 타입은 완전히 교체한다

- DOM 요소의 타입이 다르면 (`<div>` → `<span>`) 이전 노드를 버리고 새 노드 생성
- 자식 노드도 모두 새로 만듦 (비효율처럼 보이지만 실제로는 대부분 효율적)

```
// 이전
<div className="before" title="stuff" />

// 이후
<div className="after" title="stuff" />
```

→ 위 예시에서는 타입은 같으므로 className만 변경되고, title은 유지됨

2. key prop으로 리스트의 동일성 판단

- 같은 레벨의 자식 요소들을 비교할 때, key 값을 기준으로 요소를 추적
- 리스트에서 일부 항목만 변경되더라도 전체를 다시 만들지 않고, 변경된 항목만 업데이트

```
{items.map((item) => (
  <li key={item.id}>{item.name}</li>
))}
```

→ key를 통해 React는 각 아이템의 정체성을 기억함

### Virtual DOM의 장점

1. 브라우저 리렌더링 최소화

- 변경된 부분만 갱신

2. 빠른 성능

- DOM 조작 횟수를 줄여 효율적인 UI 업데이트

3. 컴포넌트 기반 개발

- UI를 작고 재사용 가능한 단위로 분리해 관리 가능

### Virtual DOM의 한계

- 메모리 사용 증가

  - Virtual DOM 자체가 메모리를 사용하므로 단순한 페이지에서는 오히려 비효율적

- 추가 연산

  - Diffing, Patching 등의 연산이 필요

- 무조건 빠르진 않음

  - 복잡한 비교 연산이 많은 경우, 직접 DOM 조작보다 느릴 수도 있음

- 사용자의 이해도에 따라 성능차
  - Component 구조를 잘못 짜면 오히려 성능 저하 초래

### 언제 효과적일까?

| 상황                               | Virtual DOM의 효과               |
| ---------------------------------- | -------------------------------- |
| UI 상태 변화가 잦은 경우           | ✅ 효율적                        |
| 많은 DOM 노드가 자주 변경되는 경우 | ✅ 효과적                        |
| 단순한 정적 페이지                 | ❌ 오히려 비효율                 |
| 대규모 SPA                         | ✅ 구조적 이점, 성능 최적화 가능 |
| 복잡한 리스트 UI                   | ✅ key로 최적화 가능             |

### 면접 대비 요약

- Virtual DOM은 브라우저 렌더링을 최소화하기 위한 메모리 기반의 중간 계층
- React는 휴리스틱 알고리즘으로 트리 비교를 O(n) 수준으로 최적화
- 실제 DOM을 직접 다루는 것보다 더 직관적이면서도 성능을 확보할 수 있는 구조
