# 운영체제 시작하기

### 시스템 자원 (= 자원)

- 프로그램 실행에 마땅히 필요한 요소들
- CPU, 메모리, 보조기억장치, 입출력장치 등과 같은 컴퓨터 부품들은 모두 자원이라고 볼 수 있음

### 운영체제

- 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램

### 커널 영역 / 사용자 영역

- 운영체제 또한 여느 프로그램과 마찬가지로 메모리에 적재되어야 함
- 다만 운영체제는 매우 특별한 프로그램이기 때문에 항상 컴퓨터가 부팅될 때 메모리 내 커널 영역(kernel space)이라는 공간에 따로 적재되어 실행됨
- 커널 영역을 제외한 나머지 영역, 사용자가 이용하는 응용 프로그램이 적재되는 영역을 사용자 영역(user space)라고 함

### 응용 프로그램

- 사용자가 특정 목적을 위해 사용하는 일반적인 프로그램
- 응용 프로그램들을 메모리 주소가 겹치지 않도록 적당한 공간에 적재하는 건 운영체제임
- 즉, 운영체제는 실행할 프로그램을 메모리에 적재하고, 더 이상 실행되지 않는 프로그램을 메모리에서 삭제하며 지속적으로 메모리를 관리함
- 응용 프로그램이 실행되려면 반드시 CPU가 필요함
- 어떤 프로그램부터 CPU를 사용하게 할지, 얼마나 오랫동안 CPU를 이용하게 할지 또한 운영체제가 해결함
- 어느 한 프로그램이 CPU를 독점하면 다른 프로그램들은 올바르게 실행될 수 없기 때문에 운영체제는 최대한 공정하게 여러 프로그램에 CPU 자원을 할당함
- 운영체제는 응용 프로그램과 하드웨어 사이에서 응용 프로그램에 필요한 자원을 할당하고, 응용 프로그램이 올바르게 실행되도록 관리하는 역할을 맡음

### 운영체제를 알아야 하는 이유

- 아무리 간단한 프로그램이라도 운영체제가 없다면 하드웨어를 조작하는 코드를 개발자가 모두 직접 작성해야 함
- 운영체제를 깊이 이해하면 운영체제가 건네는 말을 제대로 이해할 수 있고, 운영체제에 제대로 명령할 수 있게 됨
- 결과적으로 하드웨어와 프로그램을 더 깊이 이해할 수 있음

### 커널(kernel)

- 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 기능을 담당하는 부분

### 사용자 인터페이스(UI: User Interface)

- 운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스
- 운영체제가 제공하는 사용자 인터페이스의 종류에는 그래픽 유저 인터페이스, 커맨드 라인 인터페이스가 있음

### 이중 모드와 시스템 호출

- 운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지해 자원을 보호함
- 응용 프로그램들이 자원에 접근하려고 할 때 오직 운영체제를 통해서만 접근하도록 하여 자원을 보호함
- 응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근해 요청한 작업을 수행함
- 이러한 운영체제의 문지기 역할은 이중 모드로써 구현됨
- 이중 모드(dual mode): CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식
- 사용자 모드(user mode): 운영체제 서비스를 제공받을 수 없는 실행 모드
  - 즉, 커널 영역의 코드를 실행할 수 없는 모드
  - 일반적으로 응용 프로그램은 기본적으로 사용자 모드로 실행됨
  - 사용자 모드로 실행 중인 CPU는 입출력 명령어와 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없음
  - 사용자 모드로 실행되는 일반적인 응용 프로그램은 자원에 접근할 수 없음
- 커널 모드(kernel mode): 운영체제 서비스를 제공받을 수 있는 실행 모드
  - 즉, 커널 영역의 코드를 실행할 수 있는 모드
  - CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있음
  - 운영체제는 커널 모드로 실행되기 때문에 자원에 접근할 수 있음
- 시스템 호출(system call, 시스템 콜): 운영체제 서비스를 제공받기 위해 커널 모드로 전환하는 방법
  - 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공받으려면 운영체제에 요청을 보내 커널 모드로 전환되어야 함
- 시스템 호출은 일종의 인터럽트임 (정확히는 소프트웨어적인 인터럽트)
- 인터럽트는 입출력장치에 의해 발생하기도 하지만 인터럽트를 발생시키는 특정 명령어에 의해 발생하기도 하는데, 이를 소프트웨어 인터럽트라고 함
- CPU가 시스템 호출을 처리하는 순서는 인터럽트 처리 순서와 유사함
- 시스템 호출을 발생시키는 명령어가 실행되면 CPU는 지금까지의 작업을 백업하고, 커널 영역 내에 시스템 호출을 수행하는 코드(인터럽트 서비스 루틴)를 실행한 뒤 다시 기존에 실행하던 응용 프로그램으로 복귀하여 실행을 계속해 나감

### 운영체제의 핵심 서비스

- 프로세스 관리
- 자원 접근 및 할당
- 파일 시스템 관리

### 프로세스 관리

- 프로세스(process): 실행 중인 프로그램
- 일반적으로 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있게 CPU는 이 프로세스들을 조금씩 번갈아 가며 실행함
- CPU는 한 프로세스를 실행하다가 다른 프로세스로 실행을 전환하고, 그 프로세스를 실행하다가 또 다른 프로세스로 실행을 전환하는 것을 반복함
- 이때 각 프로세스는 상태도, 사용하고자 하는 자원도 다양함
- 운영체제는 다양한 프로세스를 일목요연하게 관리하고 실행할 수 있어야 함

### 자원 접근 및 할당

- 모든 프로세스는 실행을 위해 자원을 필요로 함
- 운영체제는 프로세스들이 사용할 자원에 접근하고 조작함으로써 프로세스에 필요한 자원을 할당해 줌
- 운영체제는 프로세스들에 공정하게 CPU를 할당하기 위해 어떤 프로세스부터 CPU를 이용하게 할 것인지, 얼마나 오래 CPU를 이용하게 할지를 결정할 수 있어야 함 (= CPU 스케줄링)
- 운영체제는 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지를 결정해야 함
- 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 있음
- 입출력장치가 발생시키는 하드웨어 인터럽트도 마찬가지임
- 운영체제는 인터럽트 서비스 루틴을 제공함으로써 입출력 작업을 수행함

### 파일 시스템

- 파일 시스템 또한 운영체제가 지원하는 핵심 서비스임

# Frontend Insight: 운영체제와 웹 브라우저

크롬(Chrome) 브라우저나 자바스크립트가 왜 그렇게 동작하는지, 방금 정리한 개념으로 설명하기

### 1. 사용자 모드 (User Mode)와 자바스크립트의 한계

- 사용자 모드인 응용 프로그램은 하드웨어(파일, 메모리 등)에 직접 접근할 수 없음
- 웹 브라우저에서 실행되는 자바스크립트는 철저하게 '사용자 모드'에 갇혀 있음 (이를 샌드박스 Sandbox라고도 함)
- 자바스크립트로는 사용자의 로컬 컴퓨터에 있는 C:/passwords.txt 파일을 절대 몰래 읽을 수 없음
- 운영체제가 "너는 사용자 모드니까 남의 파일 건드리지 마!" 하고 막고 있기 때문임
- 파일을 읽으려면 `<input type="file">` 처럼 사용자가 명시적으로 허락(OS 인터페이스를 통해)해야만 접근 권한이 생김

### 2. 시스템 호출 (System Call)과 Web API

- 응용 프로그램이 커널의 기능을 쓰려면 '시스템 호출'이라는 문을 두드려야 함
- 자바스크립트 코드 console.log("Hello")를 실행하면 내부적으로 `JS 엔진(V8) ➡ 브라우저 ➡ 시스템 호출(write) ➡ OS 커널 ➡ 모니터 출력` 이런 흐름이 발생함 (모니터에 글자를 띄우는 건 하드웨어(입출력장치) 작업이기 때문임)
- fetch(), navigator.geolocation(위치 정보) 같은 Web API들도 결국엔 OS에게 "네트워크 카드 좀 쓸게", "GPS 센서 좀 쓸게"라고 시스템 호출을 요청하는 껍데기(Wrapper)들임

### 3. 프로세스 관리와 크롬 탭

- 운영체제는 여러 프로세스를 관리하고, 서로 영역을 침범하지 않게 격리함
- 예전 브라우저는 탭이 10개여도 하나의 프로세스였음
- 그래서 탭 하나가 멈추면 브라우저 전체가 꺼졌음
- 최신 크롬 브라우저는 탭 하나마다 별도의 '프로세스'를 만듦 (운영체제의 프로세스 격리 기능 활용)
- 무거운 사이트가 들어있는 탭 하나가 '응답 없음'으로 죽어도, 다른 탭(프로세스)은 멀쩡하게 살아있을 수 있음
